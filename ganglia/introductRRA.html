<!DOCTYPE html>
<html>
<head>
    <title>RRA简介</title>
</head>
<body>

<h3>一、RRD的结构</h3>
<p>
Ganglia使用的数据库是RRD数据库。RRD是一种环状数据库，它所能存放的数据量是一定的，如果在RRD数据库被填满之后继续添加数据，那么添加的数据最覆盖前面的数据。
</p>
<canvas id="canvas1" width="1024" height="300" style="border:2px dotted darkgray;">
</canvas>

<h3>二、什么是RRA</h3>
<p>
前面提到，RRD数据库使用一些环状结构存储数据，这些环状的结构为称为环状存档，缩写为RRA（Round Robin Archive）。
</p>
<p>
RRD数据库在存储数据的时候，一般要使用多个RRA存储一种指标数据。举个简单的例子，我们要存储的计算机空闲CPU所占百分比的数据。我们可以用两个RRA来存储这些数据，一个RRA是存储间隔15秒的数据，共保留80个数据；另一个RRA是存储间隔1分钟的数据，共保留120个数据。
</p>
<canvas id="canvas2" width="800" height="300" style="border: 2px solid black;">
</canvas>
<p>
如果我们要以图表的形式展示最近10分钟的cpu空闲率，由于第一个RRA的数据比较精确（第一个RRA保留每15秒的数据），RRD会读取第一个RRA的数据，并生成对应的图表。
</p>
<p>
如果我们要以图表的形式展示50～60分钟以前的cpu空闲率，由于第一个RRA只覆盖最近20分钟的数据，因此RRA会调用第二个RRA（第二个RRA覆盖最近两个小时的数据）的数据生成对应的图表。但由于第二个RRA的精度没那边高，因此得到的图表不如最近10分钟精确。
</p>

<h3>三、为什么要用多个RRA</h3>
<p>
RRD数据库使用多个RRA来保存数据，主要是为了节省磁盘空间。例如，如果我们要保存过去2小时里每15秒钟的cpu空闲率，一共需要3600*2/15=480个数据点。而在前面提到的例子中，我们使用了两个RRA保存最近2个小时的cpu空闲率，一共有80+120=200个数据点。
</p>
<p>
虽然使用多个RRA可以节省磁盘空间，但缺点也是显而易见的，就是离现在时间越久远的数据精度越差。
</p>


<h3>四、怎样合理配置RRA</h3>
<p>
配置RRA的时候，在权衡磁盘占用与数据精度。如果我们只用一个RRA保存过去几年中每15秒的数据，那么磁盘占用会非常大，而且对性能也会造成影响。
</p>
<p>
一般情况下，可以根据统计周期来设置RRA。例如，我们经常要看最近一小时、最近三小时、最近一天、最近一周、最近一个月、最近三个月、最近半年、最近一年的数据。那么可以创建如下RRA：
<ol>
<li>
最近一小时与最近三小时只差三倍，可以用一个RRA保存。保存每10秒的数据估计比较合适（这没有统一标准，视实际情况而定）。那么这个RRA就设置为保留每15秒的数据，共保留1080个数据点（共覆盖三小时）;
</li>
<li>
最近一天的数据可用一个RRA保存，可以保存每分钟的数据，那么总共保存24*60=1440个数据点；
</li>
<li>
最近一周的数据可以一个RRA保存，可以保存每十分钟的数据，那么总共保存7*24*6=1008个数据点；
</li>
<li>
最近一个月与最近三个月的数据可以用一个RRA保存，可以保存每2个小时的数据，那么总共保存90*12=1080个数据点；
</li>
<li>
最近一年的数据用一个RRA保存，可以保存每半天的数据，那么总共保存365*2个数据点；
</li>
<li>
考虑到有时候可能会查看超过一年以前的数据（尽管不太经常去查看），所以还需要一个RRA，保存五年中每两天的数据，那么总共约保存913个数据。
</li>
<li>
最后还有一个因素要考虑，如果我们要查看昨天的数据，我们不太可能是在今天凌晨零点查看昨天的数据，更有可能是今天早上或中午，甚至下午。因此第二个RRA应该增加数据点，让它覆盖一天半到两天。同理，第一个RRA应该增加数据点让它覆盖五个小时。第三个RRA可以调整到覆盖10天，第四个RRA可以调整到覆盖三个半月，第五个RRA可以调整到覆盖四百天，最后一个RRA可以调整到覆盖五年半。
</li>
</ol>
</p>

</body>
<script src="introductRRA.js"></script>
</html>
